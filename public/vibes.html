<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>vibe images</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: sans-serif;
            background-color: #f5f5f5;
        }
        h1 {
            margin-bottom: 30px;
            text-align: left;
            font-size: 32px; /* Desktop size */
        }
        img {
            border: 1px solid #ddd;
            border-radius: 1px;
            transition: transform 0.2s ease;
            object-fit: cover;
        }
        #container {
            position: relative;
            min-height: 100vh;
        }
        /* Add this for mobile support */
        @media (max-width: 768px) {
            body {
                padding: 10px; /* Less padding on mobile */
            }
            
            h1 {
                font-size: 24px; /* Smaller heading on mobile */
                margin-bottom: 15px; /* Less margin on mobile */
            }
            
            p, div {
                font-size: 14px; /* Smaller text on mobile */
            }
            #container img {
                position: relative !important;
                left: 0 !important;
                top: auto !important;
                width: 100% !important;
                height: auto !important;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <h1>
        inspired by alexey guzey and sophia:
        <a href="https://guzey.com/vibes/">https://guzey.com/vibes/</a>, 
        <a href="https://girl.surgery/website_vibes/">https://girl.surgery/website_vibes/</a>
    </h1>
    <div id="container">
        <!-- Images will be placed here by JavaScript -->
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const container = document.getElementById('container');

            // Shuffle array function
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            // Fetch the metadata
            fetch('/image-metadata.json')
                .then(response => response.json())
                .then(data => {
                    // Convert to array and shuffle
                    let imageEntries = shuffleArray(Object.entries(data));
                    const containerWidth = container.clientWidth;
                    
                    // Position the images
                    const positions = [];
                    
                    // Replace the current resize code with this:
                    imageEntries.forEach(([filename, [originalWidth, originalHeight]]) => {
                        // Apply proper resizing with aspect ratio preservation
                        let targetWidth, targetHeight;
                        
                        // Maximum width should be 50% of container
                        const maxWidth = containerWidth * 0.5;
                        
                        // Calculate the scale factor based on original width
                        const scaleFactor = (originalWidth > maxWidth) ? (maxWidth / originalWidth) : 0.8;
                        
                        // Apply the scale factor to both dimensions
                        targetWidth = Math.floor(originalWidth * scaleFactor);
                        targetHeight = Math.floor(originalHeight * scaleFactor);
                        
                        // Hard cap for very large images
                        if (targetHeight > 800) {
                            const heightScaleFactor = 800 / targetHeight;
                            targetHeight = 800;
                            targetWidth = Math.floor(targetWidth * heightScaleFactor);
                        }
                        
                        // Continue with position finding...
                        
                        let foundPosition = false;
                        let attempts = 0;
                        let minTop = 0;
                        
                        // Try to find a non-overlapping position
                        while (!foundPosition && attempts < 50) {
                            const maxLeft = containerWidth - targetWidth;
                            const left = Math.floor(Math.random() * maxLeft);
                            const top = Math.floor(Math.random() * 500) + minTop;
                            
                            // Check for overlap
                            let overlaps = false;
                            for (const pos of positions) {
                                if (
                                    left < pos.left + pos.width &&
                                    left + targetWidth > pos.left &&
                                    top < pos.top + pos.height &&
                                    top + targetHeight > pos.top
                                ) {
                                    overlaps = true;
                                    break;
                                }
                            }
                            
                            if (!overlaps) {
                                // No overlap, use this position
                                positions.push({
                                    left,
                                    top,
                                    width: targetWidth,
                                    height: targetHeight
                                });
                                
                                // Create and append the image
                                const imgElement = document.createElement('img');
                                imgElement.src = `/images/${filename}`;
                                imgElement.style.position = 'absolute';
                                imgElement.style.left = `${left}px`;
                                imgElement.style.top = `${top}px`;
                                imgElement.style.width = `${targetWidth}px`;
                                imgElement.style.height = `${targetHeight}px`;
                                imgElement.loading = 'lazy';
                                
                                container.appendChild(imgElement);
                                foundPosition = true;
                            }
                            
                            attempts++;
                            
                            if (attempts >= 50) {
                                minTop += 100;
                                attempts = 0;
                            }
                        }
                    });
                    
                    // Set container height
                    let maxBottom = 0;
                    positions.forEach(pos => {
                        const bottom = pos.top + pos.height;
                        if (bottom > maxBottom) {
                            maxBottom = bottom;
                        }
                    });
                    
                    container.style.minHeight = `${maxBottom + 100}px`;
                })
                .catch(error => {
                    console.error('Error setting up the image collage:', error);
                    container.innerHTML = '<p>Error loading images.</p>';
                });
        });
    </script>
</body>
</html>